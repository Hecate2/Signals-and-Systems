clear;clc
fs=10000;
f=[784 659 784 1047 880 1047 784 784 523 587 659 587 523 587 784 659 784 1047 988 880 1047 784 784 587 659 698 494 523 880 1047 1047 988 880 988 1047 880 988 1047 880 880 784 659 523 587 ]/2;
time=fs*[1 0.5 0.5 2 1 1 2 1 0.5 0.5 1 0.5 0.5 4 1 0.5 0.5 1 0.5 1 1 2 1 0.5 0.5 1 0.5 4 1 1 2 1 0.5 0.5 2 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 4 ];
N=length(time);
y=zeros(1,N);
n=1;
for num=1:N		%利用循环产生抽样数据，num表示乐音编号
    t=1/fs:1/fs:(time(num))/fs;		%产生第num个乐音的抽样点
    P=zeros(1,time(num));		%P为存储包络数据的向量
L=(time(num))*[0 1/5 333/1000 333/500 1];
								%包络线端点对应的横坐标
    T=[0 1 0.5 0.5 0];				%包络线端点对应的纵坐标
    s=1;
    b=1:1:time(num);		%产生包络线抽样点
    for k=1:4
        P(s:L(k+1)-1)=(T(k+1)-T(k))/(L(k+1)-L(k))*(b(s:L(k+1)-1)-L(k+1)*ones(1,L(k+1)-s))+T(k+1)*ones(1,L(k+1)-s);
						%包络线直线方程通式
        s=L(k+1);
    end
   m=[1 0.307149693 0 0.057298602 0.075386387 0 0;...
       1 0.307149693 0 0.057298602 0.075386387 0 0;...
       1 0.205838324 0.157080813 0 0.088917022 0 0.06597751;...
       1 0.108616595 0.069072356 0 0 0 0;...
       1 0.275786539 0.175812244 0 0.056035202 0 0;...
       1 0.275786539 0.175812244 0 0.056035202 0 0;...
       1 0.52030544 0 0 0.05280271 0.09594026 0;...
       1 0.108616595 0.069072356 0 0 0 0];			%波形幅值矩阵
    ss=zeros(1,length(t));
    for i=1:8
        ss=ss+m(i)*sin(2*i*pi*f(num)*t);		%加谐波
    end

    y(n:n+time(num)-1)=sin(2*pi*f(num)*t).*P(1:time(num));
					%给第num个乐音加上包络
    n=n+time(num);
end
sound(y,fs);
plot(y);
